# Smart Contract Visual Diagrams

Visual representations of the On-Chain Invoice Financing smart contract architecture and flows.

---

## Table of Contents

1. [Object Relationship Diagram](#object-relationship-diagram)
2. [State Transition Diagram](#state-transition-diagram)
3. [Module Dependency Graph](#module-dependency-graph)
4. [Complete Workflow](#complete-workflow)
5. [Financial Flow](#financial-flow)
6. [Data Flow Architecture](#data-flow-architecture)

---

## Object Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Sui Blockchain Objects                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SupplierCap     â”‚ (Owned by Supplier)
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ id: UID    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ authorizes
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Invoice (Shared)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ id: UID                                              â”‚   â”‚
â”‚  â”‚ buyer: address         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚
â”‚  â”‚ supplier: address               â”‚                   â”‚   â”‚
â”‚  â”‚ amount: u64                      â”‚                  â”‚   â”‚
â”‚  â”‚ due_date: u64                    â”‚                  â”‚   â”‚
â”‚  â”‚ status: u8 (0-4)                 â”‚                  â”‚   â”‚
â”‚  â”‚ escrow_bps: u64                  â”‚                  â”‚   â”‚
â”‚  â”‚ discount_bps: u64                â”‚                  â”‚   â”‚
â”‚  â”‚ fee_bps: u64                     â”‚                  â”‚   â”‚
â”‚  â”‚ investor: Option<address> â”€â”€â”€â”   â”‚                  â”‚   â”‚
â”‚  â”‚ companies_info: vector<u8>   â”‚   â”‚                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                                â”‚
         â–¼                                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BuyerEscrow        â”‚                    â”‚  Funding (Shared)    â”‚
â”‚  (Shared)           â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                    â”‚  â”‚ id: UID        â”‚  â”‚
â”‚  â”‚ id: UID       â”‚  â”‚                    â”‚  â”‚ invoice_id: ID â”‚  â”‚
â”‚  â”‚ invoice_id:ID â”‚â—„â”€â”¼â”€references invoiceâ”€â”¼â”€â–ºâ”‚ funder: addressâ”‚  â”‚
â”‚  â”‚ buyer: addressâ”‚  â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ escrow_amount â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚ paid: bool    â”‚  â”‚
â”‚  â”‚ escrow: Bal.  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Treasury (Shared)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ id: UID                                              â”‚   â”‚
â”‚  â”‚ owner: address                                       â”‚   â”‚
â”‚  â”‚ fee_bps: u64                                         â”‚   â”‚
â”‚  â”‚ balance: Balance<SUI>                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              InvoiceFactory (Shared)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ id: UID                                              â”‚   â”‚
â”‚  â”‚ (Entry point for invoice creation)                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legend:
â”€â”€â”€â”€â”€â–º  References / Links to
â•â•â•â•â•â–º  Creates / Owns
- - - â–º Authorizes
```

---

## State Transition Diagram

```
                    INVOICE STATUS STATE MACHINE

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚    START: Supplier calls issue_invoice()                   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
              â•‘  Status: Created  â•‘  (0)
              â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
              â•‘  Invoice issued   â•‘
              â•‘  Escrow: unpaid   â•‘
              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         â”‚
                         â”‚ Buyer calls pay_escrow()
                         â”‚ â€¢ Deposits collateral
                         â”‚ â€¢ Marks escrow.paid = true
                         â”‚
                         â–¼
              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
              â•‘   Status: Ready   â•‘  (1)
              â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
              â•‘  Available for    â•‘
              â•‘  financing        â•‘
              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         â”‚
                         â”‚ Investor calls fund_invoice()
                         â”‚ â€¢ Pays purchase price
                         â”‚ â€¢ Creates Funding object
                         â”‚
                         â–¼
              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
              â•‘ Status: Financed  â•‘  (2)
              â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
              â•‘  Investor funded  â•‘
              â•‘  Awaiting repay   â•‘
              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         â”‚
                         â”‚ Buyer calls pay_invoice()
                         â”‚ â€¢ Pays full amount + discount
                         â”‚ â€¢ Distributes to parties
                         â”‚
                         â–¼
              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
              â•‘   Status: Paid    â•‘  (3)  âœ“ SUCCESS
              â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
              â•‘  Fully settled    â•‘
              â•‘  TERMINAL STATE   â•‘
              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    Alternative Path (Future):

              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
              â•‘ Status: Financed  â•‘  (2)
              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         â”‚
                         â”‚ Due date passes
                         â”‚ No payment received
                         â”‚
                         â–¼
              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
              â•‘ Status: Defaulted â•‘  (4)  âœ— FAILED
              â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
              â•‘  Payment overdue  â•‘
              â•‘  TERMINAL STATE   â•‘
              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Status Codes:
  0 = Created   (Issued, awaiting escrow)
  1 = Ready     (Escrow paid, can be financed)
  2 = Financed  (Investor funded, awaiting repayment)
  3 = Paid      (Fully settled - SUCCESS)
  4 = Defaulted (Payment failed - FAILURE, not yet implemented)

Terminal States: 3 (Paid), 4 (Defaulted)
Non-terminal States: 0 (Created), 1 (Ready), 2 (Financed)
```

---

## Module Dependency Graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              invoice_financing Package                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ invoice_factory    â”‚  (Main Entry Point)
                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                  â”‚ â”‚ init()         â”‚ â”‚
                  â”‚ â”‚ issue_invoice()â”‚ â”‚
                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ depends on
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚             â”‚             â”‚             â”‚
              â–¼             â–¼             â–¼             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  invoice    â”‚  â”‚  escrow  â”‚  â”‚ treasury â”‚  â”‚ registry â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
    â”‚ â€¢ Invoice   â”‚  â”‚ â€¢ Buyer  â”‚  â”‚ â€¢Treasuryâ”‚  â”‚ â€¢Supplierâ”‚
    â”‚   struct    â”‚  â”‚   Escrow â”‚  â”‚   struct â”‚  â”‚   Cap    â”‚
    â”‚ â€¢ Getters   â”‚  â”‚ â€¢ create â”‚  â”‚ â€¢ create â”‚  â”‚ â€¢registerâ”‚
    â”‚ â€¢ Setters   â”‚  â”‚ â€¢ pay    â”‚  â”‚ â€¢ fees   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ â€¢ create    â”‚  â”‚ â€¢ query  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
           â”‚              â”‚
           â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚   â”‚
           â–¼   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ invoice_financing    â”‚      â”‚   pay_invoice        â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚      â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
    â”‚ â€¢ fund_invoice()     â”‚      â”‚ â€¢ pay_invoice()      â”‚
    â”‚ â€¢ collect_escrow()   â”‚      â”‚ â€¢ settlement logic   â”‚
    â”‚ â€¢ Funding struct     â”‚      â”‚ â€¢ fund distribution  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Dependency Flow:
  invoice_factory  â†’  Main coordinator, calls other modules
  invoice          â†’  Core data structure, used by all
  escrow           â†’  Buyer collateral management
  treasury         â†’  Fee collection
  registry         â†’  Access control (SupplierCap)
  invoice_financingâ†’  Investor financing logic
  pay_invoice      â†’  Buyer repayment logic

Module Visibility:
  public(package)  â†’  Internal to package only
  public           â†’  External access allowed
  entry            â†’  Can be called from transactions
```

---

## Complete Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     COMPLETE INVOICE LIFECYCLE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ACTORS:
  ğŸ‘¤ Supplier (Business)
  ğŸ‘¤ Buyer (Customer)
  ğŸ‘¤ Investor (Financier)
  âš™ï¸  Smart Contract
  ğŸ’¾ Blockchain State


STEP 1: SUPPLIER REGISTRATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‘¤ Supplier
    â”‚ "I want to issue invoices"
    â”‚
    â”œâ”€â”€â–º register_supplier()
    â”‚
âš™ï¸  Smart Contract
    â”‚ â€¢ Creates SupplierCap
    â”‚ â€¢ Transfers to Supplier
    â”‚
    â”œâ”€â”€â–º SupplierCap (ID: 0xAAA...)
    â”‚
ğŸ‘¤ Supplier
    â”‚ âœ“ Can now issue invoices


STEP 2: INVOICE ISSUANCE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‘¤ Supplier
    â”‚ "Invoice for 100 SUI"
    â”‚ "Buyer: 0xBBB..."
    â”‚ "Due: Dec 31, 2025"
    â”‚
    â”œâ”€â”€â–º issue_invoice(buyer, 100_000_000_000, ...)
    â”‚    [SupplierCap: 0xAAA...]
    â”‚
âš™ï¸  Smart Contract
    â”‚ â€¢ Validates SupplierCap
    â”‚ â€¢ Calculates escrow: 10 SUI (10%)
    â”‚ â€¢ Creates Invoice (status: 0)
    â”‚ â€¢ Creates BuyerEscrow (paid: false)
    â”‚ â€¢ Emits InvoiceCreated event
    â”‚
    â”œâ”€â”€â–º Invoice (ID: 0xIII...)
    â”‚    â””â”€ amount: 100 SUI
    â”‚    â””â”€ status: Created (0)
    â”‚    â””â”€ discount: 3.2%
    â”‚
    â””â”€â”€â–º BuyerEscrow (ID: 0xEEE...)
         â””â”€ escrow_amount: 10 SUI
         â””â”€ paid: false

ğŸ’¾ Blockchain
    â”‚ âœ“ Invoice available
    â”‚ âœ“ Awaiting buyer escrow


STEP 3: BUYER PAYS ESCROW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‘¤ Buyer
    â”‚ "I'll deposit collateral"
    â”‚
    â”œâ”€â”€â–º pay_escrow(invoice, escrow, 10 SUI coin)
    â”‚
âš™ï¸  Smart Contract
    â”‚ â€¢ Validates buyer address
    â”‚ â€¢ Checks amount: 10 SUI âœ“
    â”‚ â€¢ Transfers coin to escrow
    â”‚ â€¢ Updates escrow.paid = true
    â”‚ â€¢ Updates invoice.status = 1 (Ready)
    â”‚
    â”œâ”€â”€â–º BuyerEscrow updated
    â”‚    â””â”€ paid: true
    â”‚    â””â”€ balance: 10 SUI
    â”‚
    â””â”€â”€â–º Invoice updated
         â””â”€ status: Ready (1)

ğŸ’¾ Blockchain
    â”‚ âœ“ Invoice ready for financing


STEP 4: INVESTOR FINANCES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‘¤ Investor
    â”‚ "I'll finance this invoice"
    â”‚ Purchase price: 96.8 SUI
    â”‚
    â”œâ”€â”€â–º fund_invoice(invoice, escrow, 96.8 SUI coin)
    â”‚
âš™ï¸  Smart Contract
    â”‚ â€¢ Validates escrow paid âœ“
    â”‚ â€¢ Validates status = Ready âœ“
    â”‚ â€¢ Calculates purchase price:
    â”‚   100 SUI - (100 Ã— 0.032) = 96.8 SUI âœ“
    â”‚ â€¢ Transfers 96.8 SUI to Supplier
    â”‚ â€¢ Creates Funding object
    â”‚ â€¢ Updates invoice.status = 2 (Financed)
    â”‚ â€¢ Updates invoice.investor = Investor
    â”‚
    â”œâ”€â”€â–º Transfer: 96.8 SUI
    â”‚    â””â”€ FROM: Investor
    â”‚    â””â”€ TO: Supplier âœ“
    â”‚
    â”œâ”€â”€â–º Funding created (ID: 0xFFF...)
    â”‚    â””â”€ funder: Investor
    â”‚
    â””â”€â”€â–º Invoice updated
         â””â”€ status: Financed (2)
         â””â”€ investor: Investor

ğŸ’¾ Blockchain
    â”‚ âœ“ Supplier received 96.8 SUI
    â”‚ âœ“ Investor owns invoice rights
    â”‚ âœ“ Awaiting buyer repayment


STEP 5: BUYER REPAYS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‘¤ Buyer
    â”‚ "Paying invoice + discount"
    â”‚ Total: 103.2 SUI
    â”‚
    â”œâ”€â”€â–º pay_invoice(invoice, escrow, 103.2 SUI coin)
    â”‚
âš™ï¸  Smart Contract
    â”‚ â€¢ Validates buyer address âœ“
    â”‚ â€¢ Validates not already paid âœ“
    â”‚ â€¢ Splits payment:
    â”‚   â”œâ”€ 100 SUI â†’ Supplier
    â”‚   â””â”€ 3.2 SUI â†’ Investor
    â”‚ â€¢ Updates invoice.status = 3 (Paid)
    â”‚
    â”œâ”€â”€â–º Transfer 1: 100 SUI
    â”‚    â””â”€ FROM: Buyer
    â”‚    â””â”€ TO: Supplier âœ“
    â”‚
    â”œâ”€â”€â–º Transfer 2: 3.2 SUI
    â”‚    â””â”€ FROM: Buyer
    â”‚    â””â”€ TO: Investor âœ“
    â”‚
    â””â”€â”€â–º Invoice updated
         â””â”€ status: Paid (3)

ğŸ’¾ Blockchain
    â”‚ âœ“ Invoice fully settled
    â”‚ âœ“ All parties paid


FINAL STATE
â•â•â•â•â•â•â•â•â•â•â•

ğŸ‘¤ Supplier
    â”‚ Total received: 96.8 + 100 = 196.8 SUI
    â”‚ Net for 100 SUI invoice: 196.8 SUI
    â”‚ Cost: 3.2 SUI discount (early payment)
    â”‚
ğŸ‘¤ Buyer
    â”‚ Total paid: 10 (escrow) + 103.2 (repayment) = 113.2 SUI
    â”‚ For 100 SUI invoice
    â”‚ Cost: 3.2 SUI (late payment penalty)
    â”‚ Escrow returned: 10 SUI (TODO: implement)
    â”‚
ğŸ‘¤ Investor
    â”‚ Invested: 96.8 SUI
    â”‚ Received: 3.2 SUI profit
    â”‚ ROI: 3.3% for ~46 days
    â”‚ Annualized: ~26% APY
    â”‚
âš™ï¸  Treasury
    â”‚ Fee: 0.016 SUI (0.5% of discount)
    â”‚ (TODO: implement collection)

ğŸ’¾ Blockchain
    â”‚ âœ“ Complete audit trail
    â”‚ âœ“ All events emitted
    â”‚ âœ“ Immutable record
```

---

## Financial Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MONEY FLOW DIAGRAM                               â”‚
â”‚                  (Example: 100 SUI Invoice)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PARAMETERS:
  Face Value: 100 SUI
  Discount: 3.2% (320 BPS)
  Escrow: 10% (1000 BPS)
  Fee: 0.5% of discount (50 BPS)


PHASE 1: ESCROW DEPOSIT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    ğŸ‘¤ Buyer
        â”‚
        â”‚ 10 SUI (10% collateral)
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ BuyerEscrow  â”‚
    â”‚   Balance:   â”‚
    â”‚   10 SUI     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ Locked until repayment
        â”‚


PHASE 2: FINANCING
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Calculations:
  discount_amount = 100 Ã— 0.032 = 3.2 SUI
  purchase_price = 100 - 3.2 = 96.8 SUI

    ğŸ‘¤ Investor                        ğŸ‘¤ Supplier
        â”‚                                 â–²
        â”‚ Pays 96.8 SUI                  â”‚ Receives 96.8 SUI
        â”‚                                 â”‚
        â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Invoice  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Contract  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Creates Funding record
                       â”‚ Investor owns rights to 100 SUI


PHASE 3: REPAYMENT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Calculations:
  invoice_amount = 100 SUI
  discount_amount = 3.2 SUI
  total_payment = 100 + 3.2 = 103.2 SUI
  fee_amount = 3.2 Ã— 0.005 = 0.016 SUI
  
  Split:
    supplier_portion = 100 SUI
    investor_portion = 3.2 SUI
    treasury_portion = 0.016 SUI (TODO)

    ğŸ‘¤ Buyer
        â”‚
        â”‚ 103.2 SUI total
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Payment Splitter    â”‚
    â”‚    (Contract)        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
               â”‚                 â”‚                 â”‚
               â”‚ 100 SUI         â”‚ 3.2 SUI         â”‚ 0.016 SUI
               â”‚                 â”‚                 â”‚ (TODO)
               â–¼                 â–¼                 â–¼
          ğŸ‘¤ Supplier       ğŸ‘¤ Investor       âš™ï¸  Treasury


SUMMARY TABLE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Actor      â”‚  Escrow   â”‚ Financingâ”‚ Repaymentâ”‚   Net    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Supplier     â”‚    --     â”‚  +96.8   â”‚  +100    â”‚ +196.8   â”‚
â”‚ Buyer        â”‚  -10.0    â”‚    --    â”‚ -103.2   â”‚ -113.2   â”‚
â”‚ Investor     â”‚    --     â”‚  -96.8   â”‚   +3.2   â”‚   -93.6* â”‚
â”‚ Treasury     â”‚    --     â”‚    --    â”‚  +0.016  â”‚  +0.016  â”‚
â”‚ Escrow       â”‚  +10.0    â”‚    --    â”‚  -10.0** â”‚    0     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

* Investor's 93.6 SUI = still waiting for buyer's 100 SUI face value
** Escrow returned to buyer (TODO: implement)


INVESTOR RETURN CALCULATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Initial Investment: 96.8 SUI
  Expected Return: 100 SUI (at maturity)
  Actual Profit: 3.2 SUI
  Fee Cost: 0.016 SUI
  Net Profit: 3.184 SUI
  
  ROI = 3.184 / 96.8 = 3.29%
  
  If 46 days to maturity:
  APY = (3.29% Ã— 365 days) / 46 days = 26.1%


SUPPLIER ECONOMICS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Invoice Amount: 100 SUI
  Immediate Cash: 96.8 SUI
  Later Received: 100 SUI
  Total: 196.8 SUI
  
  Cost of Early Cash: 3.2 SUI (3.2%)
  
  Benefit: Immediate liquidity instead of waiting 46 days
  Cost: 3.2% discount rate


BUYER ECONOMICS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Invoice Amount: 100 SUI
  Escrow Deposit: 10 SUI (returned at end)
  Total Payment: 103.2 SUI
  
  Extra Cost: 3.2 SUI
  Reason: Financing costs passed to buyer
  
  Escrow Return: 10 SUI (TODO: implement return logic)
  Net Cost: 103.2 - 10 = 93.2 SUI effective
```

---

## Data Flow Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SYSTEM DATA FLOW                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           WRITE PATH                                 â”‚
â”‚                    (State Mutation / Transactions)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ğŸ‘¤ User (Web Browser)
        â”‚
        â”‚ 1. Fills form
        â”‚ 2. Clicks "Submit"
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Frontend App   â”‚
    â”‚   (Next.js)      â”‚
    â”‚                  â”‚
    â”‚ â€¢ Validates form â”‚
    â”‚ â€¢ Builds TX      â”‚
    â”‚ â€¢ Requests sign  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ 3. Transaction data
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Sui Wallet      â”‚
    â”‚  Extension       â”‚
    â”‚                  â”‚
    â”‚ â€¢ Shows preview  â”‚
    â”‚ â€¢ User approves  â”‚
    â”‚ â€¢ Signs TX       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ 4. Signed transaction
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Sui RPC Node   â”‚
    â”‚                  â”‚
    â”‚ â€¢ Validates TX   â”‚
    â”‚ â€¢ Submits to     â”‚
    â”‚   validators     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ 5. Consensus
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Sui Blockchain  â”‚
    â”‚   (Validators)   â”‚
    â”‚                  â”‚
    â”‚ â€¢ Execute Move   â”‚
    â”‚ â€¢ Update state   â”‚
    â”‚ â€¢ Emit events    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                 â”‚                  â”‚
             â–¼                 â–¼                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ State Change â”‚  â”‚Event Emitted â”‚  â”‚ TX Receipt   â”‚
    â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
    â”‚ Invoice      â”‚  â”‚ Invoice      â”‚  â”‚ Digest:      â”‚
    â”‚ status = 1   â”‚  â”‚ Created      â”‚  â”‚ 0xDDDD...    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           READ PATH                                  â”‚
â”‚                    (Query / Data Retrieval)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PATH A: DIRECT BLOCKCHAIN QUERY (Real-time, Slow)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    ğŸ‘¤ User (Web Browser)
        â”‚
        â”‚ "Show me invoice 0xIII..."
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Frontend App   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ suiClient.getObject(invoiceId)
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Sui RPC Node   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Query object store
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Sui Blockchain  â”‚
    â”‚   Object Store   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Returns object data
             â”‚
             â–¼
    ğŸ‘¤ User
        â”‚ Sees invoice details


PATH B: INDEXED QUERY (Fast, Eventually Consistent)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Sui Blockchain  â”‚
    â”‚                  â”‚
    â”‚ â€¢ New block      â”‚
    â”‚ â€¢ Event emitted  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Event stream (WebSocket)
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Event Indexer   â”‚
    â”‚  (Backend)       â”‚
    â”‚                  â”‚
    â”‚ â€¢ Subscribe      â”‚
    â”‚ â€¢ Parse events   â”‚
    â”‚ â€¢ Transform      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ INSERT/UPDATE SQL
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   PostgreSQL     â”‚
    â”‚   Database       â”‚
    â”‚                  â”‚
    â”‚ â€¢ Indexed data   â”‚
    â”‚ â€¢ Fast queries   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ REST API query
             â”‚
             â–²
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Frontend App   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    ğŸ‘¤ User
        â”‚ Sees list of invoices


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   HYBRID QUERY PATTERN                               â”‚
â”‚                   (Recommended Approach)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ğŸ‘¤ User Request: "Show marketplace invoices"
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         Frontend Application             â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
         â”‚                                 â”‚
         â”‚ Fast List Query                 â”‚ Real-time Details
         â”‚ (Indexed DB)                    â”‚ (Blockchain)
         â”‚                                 â”‚
         â–¼                                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Indexer API â”‚              â”‚  Sui RPC     â”‚
    â”‚              â”‚              â”‚              â”‚
    â”‚ GET /api/    â”‚              â”‚ getObject()  â”‚
    â”‚ invoices     â”‚              â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                             â”‚
           â”‚ Returns list                â”‚ Returns details
           â”‚ (fast, cached)              â”‚ (authoritative)
           â”‚                             â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Merged     â”‚
              â”‚   Response   â”‚
              â”‚              â”‚
              â”‚ â€¢ List from  â”‚
              â”‚   indexer    â”‚
              â”‚ â€¢ Details    â”‚
              â”‚   from chain â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
                  ğŸ‘¤ User
                     â”‚ Best of both:
                     â”‚ â€¢ Fast loading
                     â”‚ â€¢ Accurate data


DATA CONSISTENCY GUARANTEE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Sui Blockchain  â”‚  â—„â”€â”€â”€ SOURCE OF TRUTH
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Events
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Event Indexer   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ ~1-5 second lag
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Database       â”‚  â—„â”€â”€â”€ EVENTUALLY CONSISTENT
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Reconciliation Job (periodic):
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 1. Query blockchain state            â”‚
    â”‚ 2. Compare with database             â”‚
    â”‚ 3. Flag discrepancies                â”‚
    â”‚ 4. Re-index missing events           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary

These diagrams illustrate:

1. **Object Relationships**: How objects reference each other
2. **State Transitions**: Valid invoice status flows
3. **Module Dependencies**: How code modules interact
4. **Complete Workflow**: Step-by-step process with all actors
5. **Financial Flow**: Money movement between parties
6. **Data Flow**: How data moves through the system

**For Implementation**:
- Use object diagrams for database schema design
- Use state diagrams for UI state management
- Use workflow for integration testing scenarios
- Use financial flow for calculation verification
- Use data flow for architecture decisions

---

**Last Updated**: November 15, 2025  
**Related Docs**: 
- `/docs/SMART_CONTRACT_DOCUMENTATION.md` - Full technical reference
- `/docs/architecture/sequence-diagrams.md` - Detailed sequence flows
